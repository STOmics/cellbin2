# CellBin Solution Technical Note


## **Introduction**

This document is divided into two parts: "Introduction to Cellbin" and "How to Use Cellbin", aiming to help users better understand "Cellbin" and provide solutions to obtain gene matrix at the level of cell accuracy. Users using this document need to obtain sequencing data and biological images in advance.

## **CellBin**


<details open>
<summary style="font-size: 15pt;">CellBinintroduce</summary>


Spatial omics can detect the expression and regulation characteristics of tissues and cells in continuous spatial dimensions. It has developed rapidly in recent years and is widely used. Among them, the stereo-seq released by BGI has the advantages of high resolution and ultra-large field of view, which can help build a spatial map of brain science, explore the space-time landscape of organism development and regeneration, and reveal molecular analysis of pathogenesis. As of September, 82 research papers have been published, 23 reviews, and 61 preprints have been published.

Stereo-seq provides a new perspective to deeply analyze organizational structure and functional relationships, but interpreting data is very dependent on targeted methods. From the information dimension, stereo-seq can continue the analysis logic of single cells while adding spatial coordinate dimensions to interpret the correlation information between various cell individuals and individuals in the overall and local spatial regions. However, molecular detection of stereo-seq does not take cells as the basic unit, and spatial transcriptome data must use algorithms to generate transcriptome information in the cellular sense. The CellBin one-stop cell segmentation product solution based on the Stereo-seq series released by BGI can directly obtain accurate single-cell expression profile information with the help of the same chip image (ssDNA, DAPI, H&E) information.

</details>


<details>
<summary style="font-size: 15pt;">CellBinFramework Description</summary>


CellBin is a process that combines spatiotemporal sequencing data with biological image maps and finally obtains cell-level precision gene matrix data. It is embedded in the StereoMap and SAW processes, and the relationship is as follows:

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/1X3lE63B7m04nJbv/img/335efa9d-3b54-4d7f-8948-c026929451e3.png)

The CellBin process includes several modules such as QC, splicing, registration, tissue segmentation, cell segmentation, cell correction, and generation of cellbin matrix. Among them, the QC module and the image manual processing part (see the QC introduction in the "CellBin Solution Technical Note" for details) are executed in the StereoMap v4 software, and the remaining modules are executed in the Stereo-seq Analysis Workflow (SAW) process.

**StereoMap v4**: StereoMap is a desktop software that does not require programming. It includes three modules: Stereo-seq data interactive visualization, manual image processing and widgets. It supports users to visualize dozens of data and simple exploration and analysis on the local computer desktop. The interactive visualization module supports the display of multi-computer and multi-modal spatiotemporal data and basic data mining; the image manual processing module migrates some image processing functions of ImageStudio and changes it to Step by step to reduce user learning costs, so as to provide image processing functions for process-based methods. QC in the widget evaluates whether images can call SAW's automatic image analysis algorithm.

**Stereo-seq Analysis Workflow (SAW): ** Spatial-temporal standard analysis process software (SAW) is a bundled pipelines, spatial-temporal standard analysis process software. The core is to locate the reads of Stereo-seq sequencing FASTQs at their spatial location on tissue sections, quantify gene expression, and intuitively present their spatial distribution. At the same time, auxiliary tools are provided to support users to make it easier to enter downstream analysis.

**QC**: Quality inspection of the chip track lines taken in biological images to determine whether they meet the requirements of subsequent automated registration modules

**Split (optional)**: If the image provided is a large picture with splicing, skip this step. If the image provided is a microscope small image, the small image will be spliced into a large image.

**Registration**: High-precision automated registration based on track lines is divided into two parts: the first part: When there is track and QC passes, the scaling scale and rotation angle of the image relative expression matrix will be calculated through the track lines; the second part: The morphological registration of the large image spliced and the gene visualization map generated by the gene after sequencing is done to obtain a 90-degree rotation or flip, and exceed the displacement parameters.

**Tisolation segmentation**: Segment the tissue profile of biological sections in the image.

**Cell segmentation**: Segment the nucleus/membrane profile of biological sections in the image.

**Cell correction**: Expand the segmented cell profile outward by 10 pixels (default) as the result of the new cell segmentation area.

For a detailed introduction to the above algorithm module, you can see: [https://www.biorxiv.org/content/10.1101/2023.02.28.530414v5](https://www.biorxiv.org/content/10.1101/2023.02.28.530414v5)

</details>


<details>
<summary style="font-size: 15pt;">CellBinAutomated use</summary>



First use StereoMap for QC, then use SAW, and execute SAW count to get the CellBin result

Take **ssDNA Demo: SS200000135TL\_D1** as an example:

**Data link: **

[http://116.6.21.110:8090/share/21bb9df9-e6c5-47c5-9aa8-29f2d23a6df4](http://116.6.21.110:8090/share/21bb9df9-e6c5-47c5-9aa8-29f2d23a6df4)

Download **SS200000135TL_D1_v5_mouse_brain_Stereo-seq_T_FF** The entire folder; image is the QC input, mask, reads and reference are the inputs of SAW.

**How to execute QC:**

How to use the QC function in Stereomap, you can read the operation documentation: [https://stereotoolss-organization.gitbook.io/stereomap-user-manual/tutorials/navigation-for-tools/stereo-seq-image-qc](https://stereotoolss-organization.gitbook.io/stereomap-user-manual/tutorials/navigation-for-tools/stereo-seq-image-qc)

How to use other features in Stereomap v4, you can read the operation documentation: [https://stereotoolss-organization.gitbook.io/stereomap-user-manual/tutorials/navigation](https://stereotoolss-organization.gitbook.io/stereomap-user-manual/tutorials/navigation)
* **How to judge QC results: **

**QC failure: ** If the following situation occurs in the software interface "The results of this image analysis evaluation are: FAIL", it means that QC failure.

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/1X3lE63B7m04nJbv/img/30b658a3-fca5-488e-b164-a692402f1eed.png)

If the imageQCfail，OnlySAW countNo picture process，That is, not to use_**"--image-tar "**_ parameter。SAWAfter the process is over，If image results are required，AvailableStereomap V4Perform manual processing。Please check for detailsSOP：[《CellbinManual operation of the process》](../CellBin_archive/CellBin/CellbinManual operation of the process.md)-Scene2:QCfail

**QC success: ** If the following situation occurs in the software interface "The results of this image analysis evaluation are: **PASS**", it means that QC is successful.

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/1X3lE63B7m04nJbv/img/51d6c550-ef6f-4f54-85b9-e23fc3bdb1ba.png)

If the imageQCsuccess，Need to runSAW countThere is a picture process，That is to increase_**"--image-tar "** parameter。

**How to execute SAW count:**
    

How to use SAW count, you can read the operation documentation: [https://stereotoolss-organization.gitbook.io/saw-user-manual-v8.0/analysis/pipelines/saw-commands](https://stereotoolss-organization.gitbook.io/saw-user-manual-v8.0/analysis/pipelines/saw-commands)

How to use other functions in SAW, you can read the detailed operation documentation: [https://stereotoolss-organization.gitbook.io/saw-user-manual-v8.0](https://stereotoolss-organization.gitbook.io/saw-user-manual-v8.0)


</details>


<details>
<summary style="font-size: 15pt;">How to viewCellBinresult</summary>




After running SAW count, the process results are as follows:

![image](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/1X3lE63B7m04nJbv/img/2581b561-2392-4518-8667-5de32716e13e.png)


Download "SN.report.tar.gz" in the outs folder and unzip it locally. ![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/1X3lE63B7m04nJbv/img/5f6c957e-e5ac-439b-8669-909e379e73de.png)

The "report.html" file in the folder is a statistical report of the results of this process. After opening the report, you can view the CellBin results. For details, please check this document [How to view Cellbin Metrics](../CellBin_archive/CellBin/How to view Cellbin Metrics.md)

</details>


<details>
<summary style="font-size: 15pt;">Manual processing plan</summary>



After understanding the CellBin indicators, if you encounter image problems such as QC failure/registration exception/tissue segmentation exception/cell segmentation exception in the above viewing CellBin results, you can use the manual processing tool in StereoMap to modify it, and then reconnect the SAW process again to obtain the results that meet the expectations. For specific operations, please refer to SOP: ["Cellbin Process Manual Operation"] (3.Cellbin Process Manual Operation.md)

The cell segmentation module can also be modified using third-party tools, and then reconnected to the SAW process to obtain the expected results. For specific operations, please check the SOP: ["Operational Instructions for Cell Segmentation Treatment"] (../CellBin_archive/QuPath_to_Cellbin/QuPath Treatment Operational Instructions for Cell Segmentation.md)


</details>